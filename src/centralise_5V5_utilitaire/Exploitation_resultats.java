package centralise_5V5_utilitaire;

import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileWriter;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;

public class Exploitation_resultats {
	
	public static void main (String args[]) {
		FileWriter fw = null;
		InputStream ips;
		InputStreamReader ipsr;
		BufferedReader br; 
		BufferedReader br1;
		String implem;
		long moyenneTempsMatch[] = new long[10];
		double ecartTypeTempsMatchIntra[] = new double[10];
		double ecartTypeTempsMatchInter;
		double moyenneDistanceTeamAdv[] = new double[10];
		double ecartTypeDistanceTeamAdvIntra[] = new double[10];
		double ecartTypeDistanceTeamAdvInter;
		long tempsTot[] = new long[10];
		double ecartTypeTempsTot;
		
		try {
			fw = new FileWriter("resultats_5V5_centralise");
		} catch (IOException e2) {
			e2.printStackTrace();
		}
		
		for (int i = 0; i < 2; i++) {
			if (i == 0) {
				implem = "random";
			}
			else {
				implem = "naif";
			}
			for (int k = 0; k < 10; k++) {
				String lu;
				String proprietes[];
				moyenneTempsMatch[k] = 0;
				ecartTypeTempsMatchIntra[k] = 0;
				moyenneDistanceTeamAdv[k] = 0;
				ecartTypeDistanceTeamAdvIntra[k] = 0;
				tempsTot[k] = 0;
	
				try {
					ips = new FileInputStream("statistiques_joueurs_" + implem + "_5V5_" + (k+1) + ".csv");
					ipsr = new InputStreamReader(ips);
					br = new BufferedReader(ipsr);
				
					//lecture de l'entête
					br.readLine();
					
					while ((lu = br.readLine()) != null) {
						proprietes = lu.split(",");
						int moyenneElo1 = 0;
						int moyenneElo2 = 0;
						int moyenneLatence1 = 0;
						int moyenneLatence2 = 0;
						
						for (int j = 1; j <= 24; j += 5) {
							moyenneElo1 += Integer.parseInt(proprietes[j]);	
						}
						moyenneElo1 = moyenneElo1 / 5;
					
						for (int j = 26; j <= 49; j += 5) {
							moyenneElo2 += Integer.parseInt(proprietes[j]);
						}
						moyenneElo2 = moyenneElo2 / 5;
						for (int j = 2; j <= 24; j += 5) {
							moyenneLatence1 += Integer.parseInt(proprietes[j]);	
						}
						moyenneLatence1 = moyenneLatence1 / 5;
						for (int j = 27; j <= 49; j += 5) {
							moyenneLatence2 += Integer.parseInt(proprietes[j]);
						}
						moyenneLatence2 = moyenneLatence2 / 5;
						
						//statistiques pour le temps de matchmaking des joueurs
						for (int j = 4; j <= 49; j += 5) { 
							moyenneTempsMatch[k] += Integer.parseInt(proprietes[j]);
						}
						
						//statistique pour la distance entre les équipes adverses
						for (int j = 1; j <= 49; j += 5) {
							moyenneDistanceTeamAdv[k] += distance(moyenneElo1,moyenneLatence1, moyenneElo2, moyenneLatence2);
						}						
					}
					moyenneDistanceTeamAdv[k] = moyenneDistanceTeamAdv[k] / 10000;
					moyenneTempsMatch[k] = moyenneTempsMatch[k] / 100000;
					
					ips.close();
					ips = new FileInputStream("statistiques_joueurs_" + implem + "_5V5_" + (k+1) + ".csv");
					ipsr = new InputStreamReader(ips);
					br = new BufferedReader(ipsr);
				
					//lecture de l'entête
					br.readLine();
					
					while ((lu = br.readLine()) != null) {
						proprietes = lu.split(",");
						int moyenne = 0;
						int moyenneElo1 = 0;
						int moyenneElo2 = 0;
						int moyenneLatence1 = 0;
						int moyenneLatence2 = 0;
						
						for (int j = 1; j <= 24; j += 5) {
							moyenne += Integer.parseInt(proprietes[j]);	
						}
						moyenneElo1 = moyenne / 5;
						moyenne = 0;
						for (int j = 26; j <= 49; j += 5) {
							moyenne += Integer.parseInt(proprietes[j]);
						}
						moyenneElo2 = moyenne / 5;
						moyenne = 0;
						for (int j = 2; j <= 24; j += 5) {
							moyenne += Integer.parseInt(proprietes[j]);	
						}
						moyenneLatence1 = moyenne / 5;
						moyenne = 0;
						for (int j = 27; j <= 49; j += 5) {
							moyenne += Integer.parseInt(proprietes[j]);
						}
						moyenneLatence2 = moyenne / 5;
						for (int j = 4; j <= 49; j+= 5) {
							ecartTypeTempsMatchIntra[k] += Math.pow((Integer.parseInt(proprietes[j]) - moyenneTempsMatch[k]), 2);
						}
						ecartTypeDistanceTeamAdvIntra[k] += Math.pow((distance(moyenneElo1,moyenneLatence1, moyenneElo2, moyenneLatence2) - moyenneDistanceTeamAdv[k]), 2);
					}	
						
					ips.close();
					ips = new FileInputStream("Statistiques_" + implem + "_5V5_temps" + (k+1) + ".csv");
					ipsr = new InputStreamReader(ips);
					br1 = new BufferedReader(ipsr);
				
					//lecture de l'entête
					br1.readLine();
					
					while ((lu = br1.readLine()) != null) {
						//statistiques pour le temps total
						tempsTot[k] = Long.parseLong(lu);					
					}
								
				} catch (FileNotFoundException e) {
					e.printStackTrace();
				}catch (IOException e) {
					e.printStackTrace();				
				} 				
			}
			
			for (int j = 0; j < 10; j++) {
				ecartTypeDistanceTeamAdvIntra[j] = Math.sqrt(ecartTypeDistanceTeamAdvIntra[j] / 10000);
				ecartTypeTempsMatchIntra[j] = Math.sqrt(ecartTypeTempsMatchIntra[j] / 100000);
			}			

			suppr_min_max_int(moyenneTempsMatch);
			suppr_min_max_double(moyenneDistanceTeamAdv);
			suppr_min_max_int(tempsTot);
			suppr_min_max_double(ecartTypeTempsMatchIntra);
			suppr_min_max_double(ecartTypeDistanceTeamAdvIntra);
			
			// calculs des écarts-type
			ecartTypeTempsMatchInter = calculEcartType(moyenneTempsMatch);
			ecartTypeTempsTot = calculEcartType(tempsTot);
			ecartTypeDistanceTeamAdvInter = calculEcartTypeDouble(moyenneDistanceTeamAdv);
			
					
			try {
				fw.write("\n\nStatistiques pour l'implémentation " + implem + "\n");
				
				fw.write("temps total d'exécution\n");
				fw.flush();
				afficheResInt(tempsTot, fw);
				fw.write("écart-type temps total = " + ecartTypeTempsTot + "\n");
				fw.flush();
				
				fw.write("temps moyen pour que les joueurs soient assignés à une équipe et matchés contre une autre\n");
				fw.flush();
				afficheResInt(moyenneTempsMatch, fw);
				fw.write("écart-type intra exécution du temps de matchmaking des joueurs\n");
				afficheResDouble(ecartTypeTempsMatchIntra, fw);
				fw.flush();
				fw.write("écart-type inter exécution du temps de matchmaking des joueurs = " + ecartTypeTempsMatchInter + "\n");
				fw.flush();
				
				fw.write("distance moyenne (summonerElo et latence) entre les joueurs des équipes adverses\n");
				fw.flush();
				afficheResDouble(moyenneDistanceTeamAdv, fw);
				fw.write("écart-type intra exécution de la distance moyenne entre les joueurs des équipes adverses\n");
				afficheResDouble(ecartTypeTempsMatchIntra, fw);
				fw.flush();
				fw.write("écart-type inter exécution de la distance moyenne entre les joueurs des équipes adverses = " + ecartTypeDistanceTeamAdvInter + "\n");
				fw.flush();
				
				
			} catch (IOException e1) {
				e1.printStackTrace();
			}		
		}
	}
	public static double distance (int summonerElo1, int latence1, int summonerElo2, int latence2) {
		return Math.sqrt(Math.pow((summonerElo1 - summonerElo2), 2) + Math.pow((latence1 - latence2), 2));
	}
	
	public static void suppr_min_max_int (long tab[]) {
		long min = tab[0];
		long max = tab[0];
		int indice_min = 0;
		int indice_max = 0;
		
		for (int i = 1; i < tab.length; i++) {
			if (tab[i] <= min) {
				min = tab[i];
				indice_min = i;
			}
			else if (tab[i] > max) {
				max = tab[i];
				indice_max = i;
			}
		}
		tab[indice_min] = -1;
		tab[indice_max] = -1;
	}
	
	public static void suppr_min_max_double (double tab[]) {
		double min = tab[0];
		double max = tab[0];
		int indice_min = 0;
		int indice_max = 0;
		
		for (int i = 1; i < tab.length; i++) {
			if (tab[i] <= min) {
				min = tab[i];
				indice_min = i;
			}
			else if (tab[i] > max) {
				max = tab[i];
				indice_max = i;
			}
		}
		if (indice_min == indice_max) {
			
		}
		tab[indice_min] = -1;
		tab[indice_max] = -1;
	}
	
	
	public static void afficheResInt (long tab[], FileWriter fw) {
		long somme = 0;
		
		try {
			for (int i = 0; i < tab.length; i++) {
				if (tab[i] != -1) {
					fw.write(tab[i] + "\n");
					fw.flush();
					somme += tab[i];
				}
			}
			fw.write("moyenne: " + (somme / (tab.length - 2)) + "\n");
			fw.flush();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}
	
	public static void afficheResDouble (double tab[], FileWriter fw) {
		double somme = 0;
		
		try {
			for (int i = 0; i < tab.length; i++) {
				if (tab[i] != -1) {
					fw.write(tab[i] + "\n");
					fw.flush();
					somme += tab[i];
				}
			}
			fw.write("moyenne: " + (somme / (tab.length - 2)) + "\n");
			fw.flush();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}
	
	public static double calculEcartType(long tab[]) {
		long moyenne = 0;
		double res = 0;
		int nb = 0;
		
		for (int i = 0; i < tab.length; i++) {
			if (tab[i] != -1) {
				moyenne += tab[i];
			}
			else {
				nb++;
			}
		}
		moyenne = moyenne / (tab.length - nb);
		for (int i = 0; i < tab.length; i++) {
			if (tab[i] != -1) {
				res += Math.pow(tab[i] - moyenne, 2);
			}
		}
		res = Math.sqrt(res / (tab.length - nb));
		
		return res;
	}
	public static double calculEcartTypeDouble(double tab[]) {
		double moyenne = 0;
		double res = 0;
		int nb = 0;
		
		for (int i = 0; i < tab.length; i++) {
			if (tab[i] != -1) {
				moyenne += tab[i];
			}
			else {
				nb++;
			}
		}
		moyenne = moyenne / (tab.length - nb);
		for (int i = 0; i < tab.length; i++) {
			if (tab[i] != -1) {
				res += Math.pow(tab[i] - moyenne, 2);
			}
		}
		res = Math.sqrt(res / (tab.length - nb));
		
		return res;
	}
}